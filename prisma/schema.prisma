// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Node {
    id                      Int         @id @default(autoincrement())
    name                    String
    type                    NodeType    @default(Node)
    network                 String
    subNetwork              String?
    latitude                Float?
    longitude               Float?
    city                    String?
    periodFirstSeenId       Int         @default(0)
    periodFirstSeen         Period      @relation(name: "nodeFirstSeen", fields: [periodFirstSeenId], references: [id])
    periodLastSeenId        Int         @default(0)
    periodLastSeen          Period      @relation(name: "nodelastSeen", fields: [periodLastSeenId], references: [id])
    periods                 NodesOnPeriods[]

    @@unique(name: "uniqueId", [name, type, network, subNetwork, latitude, longitude])
}

model Period {
    id              Int         @id @default(autoincrement())
    start           DateTime
    end             DateTime
    seenNodes       NodesOnPeriods[]

    nodeFirstSeen   Node[]      @relation(name: "nodeFirstSeen")
    nodelastSeen    Node[]      @relation(name: "nodelastSeen")

    @@unique(name: "uniqueId", [start, end])
}

model NodesOnPeriods {
    node        Node    @relation(fields: [nodeId], references: [id])
    nodeId      Int
    period      Period  @relation(fields: [periodId], references: [id])
    periodId    Int

    @@unique(name: "uniqueId", [nodeId, periodId])
}

model DayReport {
    id          Int         @id @default(autoincrement())
    day         DateTime    @unique
    validators  Int
    collators   Int
    nodes       Int
    clients     Int
}

enum NodeType {
  Validator
  Collator
  Node
}